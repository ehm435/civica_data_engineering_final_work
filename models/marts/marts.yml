version: 2

models:
  - name: dim_event
    description: "Conformed dimension containing tournament details."
    config:
      tags: ["gold", "dimension", "event"]
    columns:
      - name: event_pk
        tests: [unique, not_null]
      - name: event_name

  - name: dim_map
    description: "Conformed dimension for Valorant maps."
    config:
      tags: ["gold", "dimension", "map"]
    columns:
      - name: map_pk
        tests: [unique, not_null]
      - name: map_name

  - name: dim_agent
    description: "Conformed dimension for playable agents."
    config:
      tags: ["gold", "dimension", "agent"]
    columns:
      - name: agent_pk
        tests: [unique, not_null]
      - name: agent_name

  - name: dim_team
    description: "Conformed dimension for Teams (Normalized Names)."
    config:
      tags: ["gold", "dimension", "team"]
    columns:
      - name: team_pk
        tests: [unique, not_null]
      - name: team_name

  - name: dim_player
    description: "Conformed dimension for Players (Global ID)."
    config:
      tags: ["gold", "dimension", "player"]
    columns:
      - name: player_pk
        tests: [unique, not_null]
      - name: player_name

  - name: dim_match
    description: "Dimension containing match context (Stage, Format)."
    config:
      tags: ["gold", "dimension", "match"]
    columns:
      - name: match_pk
        tests: [unique, not_null]
      - name: match_title
      - name: stage_name

  - name: dim_date
    description: "Standard date dimension."
    config:
      tags: ["gold", "dimension", "date"]
    columns:
      - name: date_pk
        tests: [unique, not_null]
      - name: year
      - name: month
      - name: day_of_week_iso

  - name: int_event_player_directory
    description: "Intermediate model to resolve Player identities and Teams."
    config:
      tags: ["gold", "intermediate", "directory"]
    columns:
      - name: event_id
        tests: [not_null]
      - name: global_player_id
        tests: [not_null]
    tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns: ["event_id", "global_player_id"]

  - name: fct_player_map_performance
    description: "Granular fact table capturing individual player performance."
    config:
      tags: ["gold", "fact", "performance"]
    columns:
      - name: player_performance_sk
        tests: [unique, not_null]
      - name: event_fk
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_event')
                field: event_pk
      - name: map_fk
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_map')
                field: map_pk
      - name: player_fk
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_player')
                field: player_pk
      - name: team_fk
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_team')
                field: team_pk
      - name: match_fk
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_match')
                field: match_pk
      - name: date_fk
        tests:
          - not_null
          - relationships:
              arguments:
                to: ref('dim_date')
                field: date_pk
      - name: kills
      - name: deaths
      - name: acs
      - name: rating
      - name: kd_diff

  - name: fct_event_agent_stats
    description: "Aggregated fact table for Agent meta analysis (Winrate, Picks)."
    config:
      tags: ["gold", "fact", "meta"]
    columns:
      - name: agent_stats_sk
        tests: [unique, not_null]
      - name: event_fk
        tests:
          - relationships:
              arguments:
                to: ref('dim_event')
                field: event_pk
      - name: agent_fk
        tests:
          - relationships:
              arguments:
                to: ref('dim_agent')
                field: agent_pk
      - name: picks
      - name: wins
      - name: losses
      - name: win_rate_percent
      - name: avg_kills_per_map
      - name: avg_acs